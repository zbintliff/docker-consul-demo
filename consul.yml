# One max per physical node
lb:
  build: ./nginx
  container_name: 'nginx'
  environment:
    SERVICE_80_IGNORE: 'yes'
    SERVICE_8080_NAME: 'nginx-proxy'
  ports:
    - "80:80"
  links:
    - "consul"

# Only one for the whole cluster
consul:
  command: -server -bootstrap
  image: gliderlabs/consul-server:latest
  container_name: 'consul'
  environment:
    SERVICE_53_IGNORE: 'yes'
    SERVICE_8300_IGNORE: 'yes'
    SERVICE_8301_IGNORE: 'yes'
    SERVICE_8302_IGNORE: 'yes'
    SERVICE_8400_IGNORE: 'yes'
    SERVICE_8500_NAME: 'consul-admin_infra'
  ports:
    - 8600:8600
    - 8500:8500
  expose:
    - 53
    - 8300
    - 8301
    - 8302
    - 8400
    - 8500
    - 8600
  dns:
    - 127.0.0.1
# Exactly one per physical node
registrator:
  command: "-internal consul://consul:8500"
  image: gliderlabs/registrator:latest
  container_name: 'registrator'
  links:
    - "consul"
  volumes:
    - "/var/run/docker.sock:/tmp/docker.sock"
